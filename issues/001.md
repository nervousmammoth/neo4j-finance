# Issue 001: Project Setup, Testing Infrastructure & Git/GitHub

## Branch Name
`issue/001-project-setup`

## Objective
Set up the complete development infrastructure including:
- Next.js 15.1.8 project with TypeScript
- Vitest for unit/integration testing
- Playwright for E2E testing
- shadcn/ui component library
- Git repository and GitHub integration
- GitHub Actions CI/CD pipeline
- Branch protection rules
- PR template

## Dependencies
None (first issue)

## Phase: RED - Write Failing Tests

### Test Cases
Since this is infrastructure setup, we'll write a simple "smoke test" to verify the testing framework works:

1. **Test that Vitest is configured correctly**
   - Input: Simple function `add(1, 2)`
   - Expected: Returns `3`
   - Assertion: `expect(add(1, 2)).toBe(3)`

2. **Test that Playwright is configured correctly**
   - Input: Navigate to home page
   - Expected: Page loads successfully
   - Assertion: `await expect(page).toHaveTitle(/Next.js/)`

### Test File Location
- `__tests__/unit/smoke.test.ts` - Vitest smoke test
- `__tests__/e2e/smoke.spec.ts` - Playwright smoke test

### Expected Test Code
```typescript
// __tests__/unit/smoke.test.ts
import { describe, it, expect } from 'vitest'

describe('Vitest Setup', () => {
  it('should run basic test', () => {
    const add = (a: number, b: number) => a + b
    expect(add(1, 2)).toBe(3)
  })
})
```

```typescript
// __tests__/e2e/smoke.spec.ts
import { test, expect } from '@playwright/test'

test('homepage loads', async ({ page }) => {
  await page.goto('http://localhost:3000')
  await expect(page).toHaveTitle(/Next.js/)
})
```

### Git Commit
```bash
git add __tests__/
git commit -m "test: add smoke tests for testing infrastructure"
```

## Phase: GREEN - Implement

### Implementation Requirements

1. **Initialize Next.js 15 Project**
```bash
npx create-next-app@latest neo4j-finance-frontend \
  --typescript \
  --tailwind \
  --app \
  --no-src-dir \
  --import-alias "@/*"
```

2. **Install Testing Dependencies**
```bash
npm install -D vitest @vitejs/plugin-react @testing-library/react @testing-library/jest-dom @testing-library/user-event jsdom
npm install -D @playwright/test
npm install -D @types/node
```

3. **Install shadcn/ui**
```bash
npx shadcn@latest init
```

4. **Create Vitest Config** (`vitest.config.ts`)
```typescript
import { defineConfig } from 'vitest/config'
import react from '@vitejs/plugin-react'
import { resolve } from 'path'

export default defineConfig({
  plugins: [react()],
  test: {
    environment: 'jsdom',
    globals: true,
    setupFiles: ['./vitest.setup.ts'],
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html', 'lcov'],
      exclude: [
        'node_modules/',
        '__tests__/',
        '*.config.*',
        '.next/',
        'coverage/',
      ],
      thresholds: {
        branches: 80,
        functions: 90,
        lines: 90,
        statements: 90,
      },
    },
  },
  resolve: {
    alias: {
      '@': resolve(__dirname, './'),
    },
  },
})
```

5. **Create Vitest Setup** (`vitest.setup.ts`)
```typescript
import '@testing-library/jest-dom/vitest'
```

6. **Initialize Playwright**
```bash
npx playwright install
```

7. **Update package.json scripts**
```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest run --coverage",
    "test:e2e": "playwright test",
    "test:e2e:ui": "playwright test --ui",
    "type-check": "tsc --noEmit"
  }
}
```

8. **Initialize Git Repository**
```bash
git init
git add .
git commit -m "feat: initialize Next.js 15 project with testing infrastructure"
```

9. **Create GitHub Repository** (user must do this manually)
```bash
# User creates repo on GitHub, then:
git remote add origin https://github.com/[username]/neo4j-finance-frontend.git
git branch -M main
git push -u origin main
```

### File Location
- Root directory: `/home/christoph/neo4j-finance-frontend/`
- Config files: `vitest.config.ts`, `playwright.config.ts`, `vitest.setup.ts`
- Test directories: `__tests__/unit/`, `__tests__/e2e/`

### Git Commit
```bash
git add .
git commit -m "feat: configure Vitest, Playwright, and test infrastructure"
```

## Phase: REFACTOR

### Refactoring Goals
- Organize test utilities in `__tests__/utils/`
- Create test helpers for common patterns
- Ensure all paths and aliases work correctly
- Add comprehensive .gitignore

### Git Commit
```bash
git add .
git commit -m "refactor: organize test structure and add utilities"
```

## GitHub Integration

### 1. Create `.github` Structure
```bash
mkdir -p .github/workflows
```

### 2. Create CI Workflow (`.github/workflows/ci.yml`)
```yaml
name: CI

on:
  pull_request:
    branches: [main]
  push:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Type check
        run: npm run type-check

      - name: Lint
        run: npm run lint

      - name: Run unit tests
        run: npm run test:coverage

      - name: Upload coverage
        uses: codecov/codecov-action@v4
        with:
          token: ${{ secrets.CODECOV_TOKEN }}
          files: ./coverage/lcov.info
          fail_ci_if_error: false

      - name: Build
        run: npm run build
```

### 3. Create E2E Workflow (`.github/workflows/e2e.yml`)
```yaml
name: E2E Tests

on:
  pull_request:
    branches: [main]
    paths:
      - 'app/**'
      - 'components/**'
      - '__tests__/e2e/**'

jobs:
  e2e:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Install Playwright browsers
        run: npx playwright install --with-deps

      - name: Build application
        run: npm run build

      - name: Run Playwright tests
        run: npm run test:e2e

      - name: Upload test results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: playwright-report
          path: playwright-report/
          retention-days: 30
```

### 4. Create PR Template (`.github/PULL_REQUEST_TEMPLATE.md`)
```markdown
## Issue Reference
Closes #[issue number]

## Description
<!-- Describe what this PR implements -->

## Type of Change
- [ ] Bug fix
- [ ] New feature
- [ ] Breaking change
- [ ] Documentation update
- [ ] Test improvement
- [ ] Refactoring

## Testing
### Tests Added/Modified
<!-- List the tests you added or modified -->

### Coverage
- Current coverage: [X]%
- Target coverage: [Y]%

## Checklist
- [ ] All tests pass locally (`npm test`)
- [ ] E2E tests pass locally (`npm run test:e2e`)
- [ ] Coverage meets or exceeds target
- [ ] No TypeScript errors (`npm run type-check`)
- [ ] No linting errors (`npm run lint`)
- [ ] Code builds successfully (`npm run build`)
- [ ] Self-reviewed my own code
- [ ] Followed TDD approach (RED → GREEN → REFACTOR)

## Screenshots (if applicable)
<!-- Add screenshots of UI changes -->
```

### Git Commit
```bash
git add .github/
git commit -m "ci: add GitHub Actions workflows and PR template"
```

## Pull Request

### Create PR
```bash
git push origin issue/001-project-setup
gh pr create --title "Issue 001: Project Setup, Testing Infrastructure & Git/GitHub" \
             --body "$(cat issues/001.md)" \
             --label "infrastructure"
```

### PR Checklist
- [ ] Smoke tests pass locally
- [ ] TypeScript compiles without errors
- [ ] CI checks pass on GitHub
- [ ] Code reviewed
- [ ] PR approved

### Merge
```bash
gh pr merge --squash
git checkout main
git pull origin main
```

## Acceptance Criteria
- [ ] Next.js 15 project initialized with TypeScript
- [ ] Vitest configured and smoke test passes
- [ ] Playwright configured and smoke test passes
- [ ] shadcn/ui installed and configured
- [ ] Git repository initialized
- [ ] GitHub repository created and connected
- [ ] GitHub Actions CI/CD workflows created
- [ ] PR template created
- [ ] All tests pass
- [ ] CI checks pass ✅
- [ ] PR approved ✅
- [ ] Merged to main ✅

## Branch Protection Rules (User Must Configure)
After merging this PR, configure these settings on GitHub:
1. Go to Repository Settings → Branches
2. Add branch protection rule for `main`:
   - ✅ Require pull request before merging
   - ✅ Require approvals: 1
   - ✅ Require status checks to pass before merging
   - ✅ Require branches to be up to date before merging
   - ✅ Select required checks: `test`, `type-check`, `lint`, `build`
   - ❌ Allow force pushes (disabled)
   - ❌ Allow deletions (disabled)

## Estimated Effort
**L** (Large - Initial setup with multiple tools and configurations)

## Notes
- This is the foundation for all future work
- Ensure all tools work correctly before proceeding
- GitHub repository must be created manually by user
- Branch protection rules must be configured manually by user
