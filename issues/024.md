# Issue 024: Dashboard Page (/)

## Branch Name
`issue/024-dashboard-page`

## Objective
Create main dashboard page with dataset list and upload button.

## Dependencies
- Issue 016, 022 merged

## Phase: RED - Write Failing Tests

### Test Cases (8+)
1. Render dashboard page
2. Fetch and display datasets
3. Empty state when no datasets
4. Upload button navigation
5. Loading state
6. Error handling
7. Dataset card interactions
8. Server Component data fetching

### Test File Location
`__tests__/integration/pages/dashboard.test.tsx`

### Git Commit
```bash
git commit -m "test: add failing tests for dashboard page"
```

## Phase: GREEN - Implement

### Implementation (`app/page.tsx`)
```typescript
import { DatasetCard } from '@/components/DatasetCard'
import Link from 'next/link'

/**
 * Dashboard page - Server Component
 * Fetches datasets directly on the server for optimal performance
 */
export default async function DashboardPage() {
  // Fetch datasets directly in Server Component
  // Use full URL for server-side fetch or call API function directly
  const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000'
  const res = await fetch(`${baseUrl}/api/datasets`, {
    cache: 'no-store', // Always fetch fresh data for dynamic content
  })

  if (!res.ok) {
    throw new Error('Failed to fetch datasets')
  }

  const datasets = await res.json()

  return (
    <div className="container mx-auto py-8">
      <div className="flex justify-between items-center mb-6">
        <h1 className="text-3xl font-bold">Datasets</h1>
        <Link
          href="/upload"
          className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"
        >
          Upload Data
        </Link>
      </div>

      {datasets.length === 0 ? (
        <div className="text-center py-12">
          <p className="text-gray-500 mb-4">No datasets found</p>
          <Link
            href="/upload"
            className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"
          >
            Upload Your First Dataset
          </Link>
        </div>
      ) : (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {datasets.map((dataset: any) => (
            <DatasetCard key={dataset.id} dataset={dataset} />
          ))}
        </div>
      )}
    </div>
  )
}
```

### Alternative: Direct Database Query (Recommended for Production)
```typescript
// app/page.tsx - More efficient approach
import { DatasetCard } from '@/components/DatasetCard'
import { getDatasets } from '@/lib/api/datasets' // Direct database query

export default async function DashboardPage() {
  // Fetch directly from database (more efficient than API route)
  const datasets = await getDatasets()

  return (
    <div className="container mx-auto py-8">
      {/* UI implementation */}
    </div>
  )
}
```

### Create API Helper Function (`lib/api/datasets.ts`)
```typescript
import { executeQuery } from '@/lib/neo4j'

export async function getDatasets() {
  const query = `
    MATCH (d:Dataset)
    OPTIONAL MATCH (d)-[:CONTAINS]->(n)
    OPTIONAL MATCH (d)-[:HAS_RELATIONSHIP]->(r)
    RETURN d {
      .*,
      nodeCount: count(DISTINCT n),
      relationshipCount: count(DISTINCT r)
    } as dataset
    ORDER BY d.createdAt DESC
  `

  return await executeQuery(query)
}
```

### Git Commit
```bash
git commit -m "feat: implement dashboard page"
```

## Acceptance Criteria
- [ ] All 8+ tests pass
- [ ] Coverage >= 90%
- [ ] PR merged âœ…

## Estimated Effort
**M** (Medium)

## Notes
- **IMPORTANT**: Use full URL for server-side fetch in Server Components (`${baseUrl}/api/datasets`)
- Set `cache: 'no-store'` for dynamic data that changes frequently
- Alternatively, fetch data directly from the database for better performance (bypassing API route)
- Server Components in Next.js 15 can be `async` and fetch data directly
- Empty state UI improves user experience when no datasets exist
- Add proper error boundaries for production resilience
