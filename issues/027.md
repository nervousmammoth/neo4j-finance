# Issue 027: E2E Test Suite

## Branch Name
`issue/027-e2e-tests`

## Objective
Create comprehensive Playwright E2E tests covering all critical user flows.

## Dependencies
- All previous issues merged (001-026)

## Phase: RED - Write Failing Tests

### Test Scenarios (15+)

**Upload Flows:**
1. Complete upload flow - CSV file
2. Complete upload flow - XLSX file
3. Upload with invalid file type (reject)
4. Upload with malformed CSV (error handling)
5. Cancel upload mid-process

**Relationship Review:**
6. Review and approve all relationships
7. Edit relationship type
8. Delete unwanted relationship
9. Add custom relationship

**Dataset Management:**
10. View all datasets
11. View dataset details
12. Delete dataset
13. Filter datasets

**Error Scenarios:**
14. Handle API errors gracefully
15. Handle network failures

**Cross-Browser:**
- Run all tests on Chromium, Firefox, WebKit

### Test File Location
`__tests__/e2e/complete-flow.spec.ts`
`__tests__/e2e/dataset-management.spec.ts`
`__tests__/e2e/error-handling.spec.ts`

### Expected Test Code
```typescript
import { test, expect } from '@playwright/test'

test.describe('Complete Upload Flow', () => {
  test('should upload CSV and create dataset', async ({ page }) => {
    await page.goto('/')

    // Click upload button
    await page.click('text=Upload Data')

    // Upload file
    const fileInput = await page.locator('input[type="file"]')
    await fileInput.setInputFiles('./test-data/persons.csv')

    // Wait for preview
    await expect(page.locator('table')).toBeVisible()

    // Continue to relationships
    await page.click('text=Continue')

    // Review relationships
    await expect(page.locator('text=Detected Relationships')).toBeVisible()

    // Approve and import
    await page.click('text=Import')

    // Wait for completion
    await expect(page.locator('text=Import Complete')).toBeVisible()

    // Verify dataset appears on dashboard
    await page.goto('/')
    await expect(page.locator('text=persons')).toBeVisible()
  })
})
```

### Git Commit
```bash
git commit -m "test: add comprehensive E2E test suite"
```

## Phase: GREEN - Implement

Since these are E2E tests, implementation means making sure all pages and features work together correctly. No new production code needed, but may require fixing issues discovered by E2E tests.

### Test Data Setup
Create test CSV/XLSX files in `__tests__/e2e/test-data/`:
- `persons.csv`
- `accounts.csv`
- `banks.csv`
- `companies.csv`
- `transactions.csv`
- `invalid.txt`
- `malformed.csv`

### Git Commit
```bash
git commit -m "chore: add E2E test data files"
```

## Phase: REFACTOR

### Refactoring Goals
- Add visual regression testing
- Add performance benchmarks
- Optimize test execution time
- Add parallel execution

### Git Commit
```bash
git commit -m "refactor: optimize E2E test execution"
```

## Pull Request

### Create PR
```bash
git push origin issue/027-e2e-tests
gh pr create --title "Issue 027: E2E Test Suite" \
             --body "$(cat issues/027.md)" \
             --label "testing,e2e"
```

### PR Checklist
- [ ] All 15+ E2E scenarios pass
- [ ] Tests pass on Chromium, Firefox, WebKit
- [ ] Coverage of critical paths: 100%
- [ ] Test execution time reasonable (<5 minutes)
- [ ] CI checks pass
- [ ] PR approved

### Merge
```bash
gh pr merge --squash
git checkout main
git pull origin main
```

## Acceptance Criteria
- [ ] All 15+ E2E scenarios implemented
- [ ] Tests pass on all browsers
- [ ] Complete user flows covered
- [ ] Error scenarios tested
- [ ] CI integration working
- [ ] PR merged âœ…
- [ ] **PROJECT COMPLETE** ðŸŽ‰

## Estimated Effort
**L** (Large)

## Notes
- This is the final issue - project completion milestone
- E2E tests validate the entire system works together
- Consider adding visual regression testing with Percy or similar
- Set up scheduled E2E test runs on CI (nightly)
