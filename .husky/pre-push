#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîí Checking for markdown files in commits..."

# Read stdin to get the range of commits being pushed
while read local_ref local_sha remote_ref remote_sha
do
    if [ "$local_sha" = "0000000000000000000000000000000000000000" ]; then
        # This is a branch deletion, allow it
        continue
    fi

    if [ "$remote_sha" = "0000000000000000000000000000000000000000" ]; then
        # New branch, check all commits
        range="$local_sha"
    else
        # Update to existing branch, check new commits
        range="$remote_sha..$local_sha"
    fi

    # Check if any markdown files are in the commits being pushed
    md_files=$(git diff --name-only --diff-filter=ACM "$range" | grep '\.md$')

    if [ -n "$md_files" ]; then
        echo ""
        echo "‚ùå ERROR: Attempting to push markdown files to remote repository:"
        echo "$md_files" | sed 's/^/     /'
        echo ""
        echo "üìù Markdown files should remain local only."
        echo ""
        echo "To fix this:"
        echo "  1. Remove markdown files from your commits: git reset HEAD~1"
        echo "  2. Unstage markdown files: git reset HEAD *.md"
        echo "  3. Commit without markdown files"
        echo "  4. Try pushing again"
        echo ""
        exit 1
    fi
done

echo "‚úÖ No markdown files detected in push"
